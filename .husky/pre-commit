set -e  # Exit on any error

echo "ğŸ§¹ Cleaning up unused dependencies..."
pnpm cleanup

echo "ğŸ“¦ Installing dependencies..."
pnpm install

echo "ğŸ”„ Running parallel checks..."
# Run independent tasks in parallel with proper error handling
{
  echo "ğŸ” Type checking..." && pnpm check-types
} &
TYPE_CHECK_PID=$!

{
  echo "ğŸ”§ Linting code..." && pnpm lint
} &
LINT_PID=$!

{
  echo "ğŸ’… Formatting code..." && pnpm format:check
} &
FORMAT_PID=$!

# Wait for all parallel tasks to complete
wait $TYPE_CHECK_PID || exit 1
wait $LINT_PID || exit 1  
wait $FORMAT_PID || exit 1

echo "âœ… Parallel checks completed successfully"

echo "ğŸ§ª Running tests..."
pnpm test

echo "ğŸ—ï¸ Building packages..."
pnpm build

echo "ğŸ‰ Pre-commit checks completed successfully!"
